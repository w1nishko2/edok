# üé® –í–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏ –Ω–∞ –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–æ–≤ –ø—Ä–∏ –∏—Ö –∑–∞–≥—Ä—É–∑–∫–µ –ø–∞—Ä—Å–µ—Ä–æ–º. –í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º.

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤

–í —Ñ–∞–π–ª–µ `.env`:

```env
# –í–∫–ª—é—á–∏—Ç—å –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏ (true/false)
WATERMARK_ENABLED=true

# –¢–µ–∫—Å—Ç –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
WATERMARK_TEXT="im-edok.ru"
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

–ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ `.env`, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è:
- `WATERMARK_ENABLED` = `true`
- `WATERMARK_TEXT` = –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `APP_NAME` –∏–ª–∏ `"im-edok.ru"`

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ PHP –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ **GD** (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫).

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

- ‚úÖ JPEG (.jpg, .jpeg)
- ‚úÖ PNG (.png)
- ‚úÖ GIF (.gif)
- ‚úÖ WebP (.webp)

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞

- **–ü–æ–∑–∏—Ü–∏—è**: –ø—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π —É–≥–æ–ª
- **–û—Ç—Å—Ç—É–ø**: 15px –æ—Ç –∫—Ä–∞—ë–≤
- **–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞**: –±–µ–ª—ã–π —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é 70%
- **–¢–µ–Ω—å**: —á—ë—Ä–Ω–∞—è —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é 50%, —Å–º–µ—â–µ–Ω–∏–µ 2px
- **–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞**: 2.5% –æ—Ç —à–∏—Ä–∏–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–∏–Ω–∏–º—É–º 12px)
- **–®—Ä–∏—Ñ—Ç**: —Å–∏—Å—Ç–µ–º–Ω—ã–π TrueType –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π GD

### –ì–¥–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏

1. **–ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞** - –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —á–µ—Ä–µ–∑ `RecipeParserService::downloadImage()`
2. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —à–∞–≥–æ–≤ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è** - –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —á–µ—Ä–µ–∑ `RecipeParserService::downloadStepImage()`

## üìÅ –§–∞–π–ª—ã

- `app/Services/WatermarkService.php` - —Å–µ—Ä–≤–∏—Å –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤
- `config/app.php` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–µ–∫—Ü–∏—è Watermark Configuration)
- `.env` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –≤–æ–¥—è–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤:

```bash
php test-watermark.php
```

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ù–∞–ª–∏—á–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è GD
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ù–∞–ª–∏—á–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤
- –°–æ–∑–¥–∞—ë—Ç —Ç–µ—Å—Ç–æ–≤—É—é –∫–æ–ø–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–æ–¥—è–Ω—ã–º –∑–Ω–∞–∫–æ–º

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```php
use App\Services\WatermarkService;

$service = new WatermarkService();

// –î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
$result = $service->addWatermark('recipes/example.jpg');

// –î–æ–±–∞–≤–∏—Ç—å —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
$result = $service->addWatermark('recipes/example.jpg', '–ú–æ–π —Å–∞–π—Ç');
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–∞—Ä—Å–∏–Ω–≥ —Å –≤–æ–¥—è–Ω—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–º–∞–Ω–¥ –ø–∞—Ä—Å–µ—Ä–∞ –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```bash
# –°–æ–±—Ä–∞—Ç—å URL —Ä–µ—Ü–µ–ø—Ç–æ–≤
php artisan recipes:collect-urls

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—á–µ—Ä–µ–¥—å (—Å–∫–∞—á–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–æ–¥—è–Ω—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏)
php artisan recipes:process-queue
```

### –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏:

```env
WATERMARK_ENABLED=false
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞

–ò–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞:

```env
WATERMARK_TEXT="–≤–∞—à-—Å–∞–π—Ç.ru"
```

## üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ—Ç TrueType —à—Ä–∏—Ñ—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –º–µ—Å—Ç–∞—Ö:

**Windows:**
- `C:/Windows/Fonts/arial.ttf`
- `C:/Windows/Fonts/arialbd.ttf`
- `C:/Windows/Fonts/calibri.ttf`
- `C:/Windows/Fonts/verdana.ttf`

**Linux:**
- `/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf`
- `/usr/share/fonts/truetype/liberation/LiberationSans-Regular.ttf`
- `/usr/share/fonts/truetype/freefont/FreeSans.ttf`

–ï—Å–ª–∏ —à—Ä–∏—Ñ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç GD (–º–µ–Ω–µ–µ –∫—Ä–∞—Å–∏–≤—ã–π, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç).

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü—Ä–æ–¥–∞–∫—à–Ω**: –≤—Å–µ–≥–¥–∞ –¥–µ—Ä–∂–∏—Ç–µ `WATERMARK_ENABLED=true`
2. **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
3. **–¢–µ–∫—Å—Ç**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç (–¥–æ 15 —Å–∏–º–≤–æ–ª–æ–≤) –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
4. **–®—Ä–∏—Ñ—Ç—ã**: –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ GD –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

**–û—à–∏–±–∫–∞**: `Call to undefined function imagecreatefromjpeg()`

**–†–µ—à–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ GD –¥–ª—è PHP:
```bash
# Ubuntu/Debian
sudo apt-get install php-gd

# Windows (OSPanel)
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ php.ini: extension=gd
```

### –®—Ä–∏—Ñ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

**–°–∏–º–ø—Ç–æ–º**: –í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ–∫—Ä–∞—Å–∏–≤–æ

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–∏—Å—Ç–µ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ —à—Ä–∏—Ñ—Ç—É –≤—Ä—É—á–Ω—É—é –≤ `WatermarkService::findSystemFont()`

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª—é–±–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
- –ü—É—Ç—å: `storage/app/public/recipes/*.jpg`
- –í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É
- –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Ç–∞–µ–º—ã–º —Å –ª—ë–≥–∫–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 5 –Ω–æ—è–±—Ä—è 2025 –≥.
